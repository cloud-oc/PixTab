// fflate unzip subset (MIT) - exports unzipSync and strFromU8
const u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);function freb(eb,start){for(var b=new u16(31),i=0;i<31;++i)b[i]=start+=1<<eb[i-1];for(var r=new i32(b[30]),i=1;i<30;++i)for(var j=b[i];j<b[i+1];++j)r[j]=j-b[i]<<5|i;return{b,r}}var _a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b.b,revfd=_b.r,rev=new u16(32768);for(var i=0;i<32768;++i){var x=(43690&i)>>1|(21845&i)<<1;x=(61680&(x=(52428&x)>>2|(13107&x)<<2))>>4|(3855&x)<<4,rev[i]=((65280&x)>>8|(255&x)<<8)>>1}function hMap(cd,mb,r){var s=cd.length,i=0,l=new u16(mb);for(;i<s;++i)cd[i]&&++l[cd[i]-1];var le,o=new u16(mb);for(i=1;i<mb;++i)o[i]=o[i-1]+l[i-1]<<1;if(r){le=new u16(1<<mb);var rvb=15-mb;for(i=0;i<s;++i)if(cd[i]){for(var sv=i<<4|cd[i],r2=mb-cd[i],v=o[cd[i]-1]++<<r2,m=v+(1<<r2)-1;v<=m;++v)le[rev[v]>>rvb]=sv}}else for(le=new u16(s),i=0;i<s;++i)cd[i]&&(le[i]=rev[o[cd[i]-1]++]>>15-cd[i]);return le}var flt=new u8(288);for(i=0;i<144;++i)flt[i]=8;for(i=144;i<256;++i)flt[i]=9;for(i=256;i<280;++i)flt[i]=7;for(i=280;i<288;++i)flt[i]=8;var fdt=new u8(32);for(i=0;i<32;++i)fdt[i]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1);function max(a){for(var m=a[0],i=1;i<a.length;++i)a[i]>m&&(m=a[i]);return m}function bits(d,p,m){var o=p/8|0;return(d[o]|d[o+1]<<8)>>(7&p)&m}function bits16(d,p){var o=p/8|0;return(d[o]|d[o+1]<<8|d[o+2]<<16)>>(7&p)}function shft(p){return(p+7)/8|0}function slc(v,s,e){return(null==s||s<0)&&(s=0),(null==e||e>v.length)&&(e=v.length),new u8(v.subarray(s,e))}var ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data","unknown compression method"];function err(ind,msg,nt){var e=new Error(msg||ec[ind]);if(e.code=ind,Error.captureStackTrace&&Error.captureStackTrace(e,err),!nt)throw e;return e}function inflt(dat,st,buf,dict){var sl=dat.length,dl=dict?dict.length:0;if(!sl||st.f&&!st.l)return buf||new u8(0);var noBuf=!buf,resize=noBuf||2!=st.i;var noSt=st.i;noBuf&&(buf=new u8(3*sl));var cbuf=function(l){var bl=buf.length;if(l>bl){var nbuf=new u8(Math.max(2*bl,l));nbuf.set(buf),buf=nbuf}},final=st.f||0,pos=st.p||0,bt=st.b||0,lm=st.l,dm=st.d,lbt=st.m,dbt=st.n,tbts=8*sl;do{if(!lm){final=bits(dat,pos,1);var type=bits(dat,pos+1,3);if(pos+=3,!type){var s=shft(pos)+4,l=dat[s-4]|dat[s-3]<<8,t=s+l;if(t>sl){noSt&&err(0);break}resize&&cbuf(bt+l),buf.set(dat.subarray(s,t),bt),st.b=bt+=l,st.p=pos=8*t,st.f=final;continue}if(1==type)lm=flrm,dm=fdrm,lbt=9,dbt=5;else if(2==type){var hLit=bits(dat,pos,31)+257,hcLen=bits(dat,pos+10,15)+4,tl=hLit+bits(dat,pos+5,31)+1;pos+=14;for(var ldt=new u8(tl),clt=new u8(19),i=0;i<hcLen;++i)clt[clim[i]]=bits(dat,pos+3*i,7);pos+=3*hcLen;var clb=max(clt),clbmsk=(1<<clb)-1,clm=hMap(clt,clb,1);for(i=0;i<tl;){var r=clm[bits(dat,pos,clbmsk)];pos+=15&r;var sym=r>>4;if(sym<16)ldt[i++]=sym;else{var c=0,n=0;16==sym?(n=3+bits(dat,pos,3),pos+=2,c=ldt[i-1]):17==sym?(n=3+bits(dat,pos,7),pos+=3):(n=11+bits(dat,pos,127),pos+=7);for(;n--;)ldt[i++]=c}}var lt=ldt.subarray(0,hLit),dt=ldt.subarray(hLit);lbt=max(lt),dbt=max(dt),lm=hMap(lt,lbt,1),dm=hMap(dt,dbt,1)}else err(1);if(pos>tbts){noSt&&err(0);break}}resize&&cbuf(bt+131072);for(var lms=(1<<lbt)-1,dms=(1<<dbt)-1,lpos=pos;;lpos=pos){var c=lm[bits16(dat,pos)&lms],sym=c>>4;if((pos+=15&c)>tbts){noSt&&err(0);break}c||err(2);if(sym<256)buf[bt++]=sym;else{if(256==sym){lpos=pos,lm=null;break}var add=sym-254;if(sym>264){var i=sym-257,bitsIn=fleb[i];add=bits(dat,pos,(1<<bitsIn)-1)+fl[i],pos+=bitsIn}var d=dm[bits16(dat,pos)&dms],dsym=d>>4;if(!d)err(3);pos+=15&d;var dist=fd[dsym];if(dsym>3){var dbits=fdeb[dsym];dist+=bits16(dat,pos)&(1<<dbits)-1,pos+=dbits}if(pos>tbts){noSt&&err(0);break}resize&&cbuf(bt+131072);for(var end=bt+add;bt<dist;){var shift=dl-dist,dend=Math.min(dist,end);shift+bt<0&&err(3);for(;bt<dend;++bt)buf[bt]=dict[shift+bt]}for(;bt<end;++bt)buf[bt]=buf[bt-dist]}}st.l=lm,st.p=lpos,st.b=bt,st.f=final,lm&&(final=1,st.m=lbt,st.d=dm,st.n=dbt)}while(!final);return bt!=buf.length&&noBuf?slc(buf,0,bt):buf.subarray(0,bt)}function inflateSync(data,opt){return inflt(data,{i:2},opt&&opt.out,opt&&opt.dictionary)}var te="undefined"!=typeof TextEncoder&&new TextEncoder,td="undefined"!=typeof TextDecoder&&new TextDecoder,tds=0;try{td.decode(new u8(0),{stream:!0}),tds=1}catch(e){}function dutf8(d){for(var r="",i=0;;){var c=d[i++],eb=(c>127)+(c>223)+(c>239);if(i+eb>d.length)return{s:r,r:slc(d,i-1)};if(eb?3==eb?(c=((15&c)<<18|(63&d[i++])<<12|(63&d[i++])<<6|63&d[i++])-65536,r+=String.fromCharCode(55296|c>>10,56320|1023&c)):r+=1&eb?String.fromCharCode((31&c)<<6|63&d[i++]):String.fromCharCode((15&c)<<12|(63&d[i++])<<6|63&d[i++]):r+=String.fromCharCode(c),!eb&&i>=d.length)return{s:r,r:new u8(0)}}}function strFromU8(dat,latin1){if(latin1){for(var r="",i=0;i<dat.length;i+=16384)r+=String.fromCharCode.apply(null,dat.subarray(i,i+16384));return r}if(td)return td.decode(dat);var _a=dutf8(dat),s=_a.s,r=_a.r;if(r.length)err(8);return s}function b2(d,b){return d[b]|d[b+1]<<8}function b4(d,b){return(d[b]|d[b+1]<<8|d[b+2]<<16|d[b+3]<<24)>>>0}function b8(d,b){return b4(d,b)+4294967296*b4(d,b+4)}function slzh(d,b){return b+30+b2(d,b+26)+b2(d,b+28)}function z64e(d,b){for(;1!=b2(d,b);b+=4+b2(d,b+2));return[b8(d,b+12),b8(d,b+4),b8(d,b+20)]}function zh(d,b,z){var fnl=b2(d,b+28),fn=strFromU8(d.subarray(b+46,b+46+fnl),!(2048&b2(d,b+8))),es=b+46+fnl,bs=b4(d,b+20),_a=z&&4294967295==bs?z64e(d,es):[bs,b4(d,b+24),b4(d,b+42)],sc=_a[0],su=_a[1],off=_a[2];return[b2(d,b+10),sc,su,fn,es+b2(d,b+30)+b2(d,b+32),off]}function unzipSync(data,opt){for(var files={},e=data.length-22;101010256!=b4(data,e);--e)(!e||data.length-e>65558)&&err(13);var c=b2(data,e+8);if(!c)return{};var o=b4(data,e+16),z=o==4294967295||65535==c;if(z){var ze=b4(data,e-12);(z=101075792==b4(data,ze))&&(c=b2(data,e+8),o=b4(data,ze+48))}for(var fltr=opt&&opt.filter,i=0;i<c;++i){var _a=zh(data,o,z),cmp=_a[0],sc=_a[1],su=_a[2],fn=_a[3],no=_a[4],off=_a[5],b=slzh(data,off);o=no;if(!fltr||fltr({name:fn,size:sc,originalSize:su,compression:cmp}))if(cmp)8==cmp?files[fn]=inflateSync(data.subarray(b,b+sc),{out:new u8(su)}):err(14,"unknown compression type "+cmp);else files[fn]=slc(data,b,b+sc)}return files}export{unzipSync,strFromU8};